<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’– Ø³Ø§ÛŒØª Ø¹Ø§Ø´Ù‚Ø§Ù†Ù‡ Ù…Ø§</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&family=Pacifico&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-family: 'Pacifico', cursive;
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Vazirmatn', sans-serif;
            margin-top: 10px;
        }

        .logout-btn:hover {
            background: white;
            color: #667eea;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab {
            background: white;
            padding: 15px 30px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .tab.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Kiss Counter */
        .kiss-counter {
            text-align: center;
        }

        .kiss-number {
            font-size: 5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 30px 0;
        }

        .kiss-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 2rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
        }

        .kiss-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(245, 87, 108, 0.6);
        }

        .reset-btn {
            background: #666;
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Gallery */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .gallery-item {
            background: #f5f5f5;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .gallery-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .gallery-caption {
            padding: 15px;
        }

        .gallery-date {
            color: #999;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .add-photo-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        /* Notes */
        .note-item {
            background: #fff9c4;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .note-date {
            color: #666;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            float: left;
            margin-top: 10px;
        }

        /* Todos */
        .todo-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .todo-item.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .todo-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Chat */
        .chat-container {
            height: 400px;
            overflow-y: auto;
            background: #f5f5f5;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .chat-message {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        .chat-message.ali {
            justify-content: flex-end;
        }

        .chat-bubble {
            max-width: 60%;
            padding: 12px 18px;
            border-radius: 18px;
            background: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .chat-message.ali .chat-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .chat-time {
            font-size: 0.75rem;
            color: #999;
            margin-top: 5px;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Vazirmatn', sans-serif;
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            cursor: pointer;
        }

        /* Music */
        .music-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .music-info h3 {
            margin-bottom: 5px;
        }

        .music-artist {
            color: #666;
            font-size: 0.9rem;
        }

        .play-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Input styles */
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 1rem;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
        }

        /* Login Page */
        .login-container {
            background: white;
            padding: 50px 40px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            margin: 100px auto;
        }

        .heart-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .login-title {
            font-family: 'Pacifico', cursive;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }

        input[type="password"] {
            width: 100%;
            padding: 15px 20px;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1.1rem;
            text-align: center;
            letter-spacing: 3px;
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .error-msg {
            color: #f5576c;
            margin-top: 15px;
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://beknooiptdlespqxcfpt.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_XYDCUqTTxmO1-jl73JhRFA_siNtwS91';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const PASSWORD = 'AG001';
        let isAuthenticated = false;
        let currentTab = 'kiss';
        let currentUser = '';

        // Initialize app
        async function init() {
            checkAuth();
            if (isAuthenticated) {
                await initDatabase();
                renderApp();
                loadData();
            } else {
                renderLogin();
            }
        }

        // Check authentication
        function checkAuth() {
            isAuthenticated = sessionStorage.getItem('authenticated') === 'true';
            currentUser = sessionStorage.getItem('currentUser') || '';
        }

        // Initialize database tables
        async function initDatabase() {
            // Tables will be created manually in Supabase dashboard
            // We'll create them in the next step
        }

        // Render login page
        function renderLogin() {
            document.getElementById('app').innerHTML = `
                <div class="login-container">
                    <div class="heart-icon">ğŸ’–</div>
                    <h1 class="login-title">Ø³Ø§ÛŒØª Ù…Ø§</h1>
                    <p style="color: #666; margin-bottom: 20px;">Ù„Ø·ÙØ§Ù‹ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
                    <input type="password" id="passwordInput" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" onkeypress="if(event.key==='Enter') login()">
                    <button class="login-btn" onclick="login()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³Ø§ÛŒØª â¤ï¸</button>
                    <div class="error-msg" id="errorMsg">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!</div>
                </div>
            `;
        }

        // Login function
        function login() {
            const password = document.getElementById('passwordInput').value;
            if (password === PASSWORD) {
                sessionStorage.setItem('authenticated', 'true');
                sessionStorage.setItem('currentUser', password === 'AG001' ? 'ali' : 'gandom');
                isAuthenticated = true;
                currentUser = sessionStorage.getItem('currentUser');
                init();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }

        // Logout
        function logout() {
            sessionStorage.removeItem('authenticated');
            sessionStorage.removeItem('currentUser');
            isAuthenticated = false;
            renderLogin();
        }

        // Render main app
        function renderApp() {
            document.getElementById('app').innerHTML = `
                <div class="container">
                    <div class="header">
                        <h1>ğŸ’– Ø³Ø§ÛŒØª Ø¹Ø§Ø´Ù‚Ø§Ù†Ù‡ Ù…Ø§</h1>
                        <p>Ø³Ù„Ø§Ù… ${currentUser === 'ali' ? 'Ø¹Ù„ÛŒ' : 'Ú¯Ù†Ø¯Ù…'} Ø¹Ø²ÛŒØ²! ğŸ’•</p>
                        <button class="logout-btn" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
                    </div>

                    <div class="tabs">
                        <div class="tab ${currentTab === 'kiss' ? 'active' : ''}" onclick="switchTab('kiss')">ğŸ’‹ Ø¨ÙˆØ³â€ŒÙ‡Ø§</div>
                        <div class="tab ${currentTab === 'gallery' ? 'active' : ''}" onclick="switchTab('gallery')">ğŸ“· Ú¯Ø§Ù„Ø±ÛŒ</div>
                        <div class="tab ${currentTab === 'notes' ? 'active' : ''}" onclick="switchTab('notes')">ğŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</div>
                        <div class="tab ${currentTab === 'todos' ? 'active' : ''}" onclick="switchTab('todos')">âœ… Ú©Ø§Ø±Ù‡Ø§</div>
                        <div class="tab ${currentTab === 'chat' ? 'active' : ''}" onclick="switchTab('chat')">ğŸ’¬ Ú†Øª</div>
                        <div class="tab ${currentTab === 'music' ? 'active' : ''}" onclick="switchTab('music')">ğŸµ Ù…ÙˆØ²ÛŒÚ©</div>
                    </div>

                    <div id="kiss-tab" class="tab-content ${currentTab === 'kiss' ? 'active' : ''}">
                        <div class="kiss-counter">
                            <h2>ğŸ’‹ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¨ÙˆØ³â€ŒÙ‡Ø§ÛŒ Ù…Ø§</h2>
                            <div class="kiss-number" id="kissCount">0</div>
                            <button class="kiss-btn" onclick="addKiss()">ğŸ’‹ Ø¨ÙˆØ³!</button>
                            <br>
                            <button class="reset-btn" onclick="resetKiss()">ğŸ”„ Ø±ÛŒØ³Øª</button>
                        </div>
                    </div>

                    <div id="gallery-tab" class="tab-content ${currentTab === 'gallery' ? 'active' : ''}">
                        <h2>ğŸ“· Ú¯Ø§Ù„Ø±ÛŒ Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ù…Ø§</h2>
                        <button class="add-photo-btn" onclick="showAddPhotoForm()">â• Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ú©Ø³</button>
                        <div id="addPhotoForm" style="display: none; margin-bottom: 20px;">
                            <input type="text" id="photoUrl" placeholder="Ù„ÛŒÙ†Ú© Ø¹Ú©Ø³ (Ø§Ø² imgur ÛŒØ§ imgbb)">
                            <textarea id="photoCaption" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª..."></textarea>
                            <button class="submit-btn" onclick="addPhoto()">Ø°Ø®ÛŒØ±Ù‡ Ø¹Ú©Ø³</button>
                        </div>
                        <div class="gallery-grid" id="galleryGrid"></div>
                    </div>

                    <div id="notes-tab" class="tab-content ${currentTab === 'notes' ? 'active' : ''}">
                        <h2>ğŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø§</h2>
                        <textarea id="noteText" placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ù†ÙˆÛŒØ³..."></textarea>
                        <button class="submit-btn" onclick="addNote()">Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</button>
                        <div id="notesList" style="margin-top: 20px;"></div>
                    </div>

                    <div id="todos-tab" class="tab-content ${currentTab === 'todos' ? 'active' : ''}">
                        <h2>âœ… Ú©Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø§</h2>
                        <input type="text" id="todoText" placeholder="Ú©Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†..." onkeypress="if(event.key==='Enter') addTodo()">
                        <button class="submit-btn" onclick="addTodo()">Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù†</button>
                        <div id="todosList" style="margin-top: 20px;"></div>
                    </div>

                    <div id="chat-tab" class="tab-content ${currentTab === 'chat' ? 'active' : ''}">
                        <h2>ğŸ’¬ Ú†Øª Ù…Ø§</h2>
                        <div class="chat-container" id="chatContainer"></div>
                        <div class="chat-input-container">
                            <input type="text" class="chat-input" id="chatInput" placeholder="Ù¾ÛŒØ§Ù… Ø¨Ù†ÙˆÛŒØ³..." onkeypress="if(event.key==='Enter') sendMessage()">
                            <button class="send-btn" onclick="sendMessage()">Ø§Ø±Ø³Ø§Ù„</button>
                        </div>
                    </div>

                    <div id="music-tab" class="tab-content ${currentTab === 'music' ? 'active' : ''}">
                        <h2>ğŸµ Ø¢Ù‡Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù…Ø§</h2>
                        <input type="text" id="musicTitle" placeholder="Ù†Ø§Ù… Ø¢Ù‡Ù†Ú¯">
                        <input type="text" id="musicArtist" placeholder="Ø®ÙˆØ§Ù†Ù†Ø¯Ù‡">
                        <input type="text" id="musicUrl" placeholder="Ù„ÛŒÙ†Ú© YouTube ÛŒØ§ Spotify">
                        <button class="submit-btn" onclick="addMusic()">Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¢Ù‡Ù†Ú¯</button>
                        <div id="musicList" style="margin-top: 20px;"></div>
                    </div>
                </div>
            `;
        }

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;
            renderApp();
            loadData();
        }

        // Load all data
        async function loadData() {
            if (currentTab === 'kiss') await loadKissCount();
            if (currentTab === 'gallery') await loadGallery();
            if (currentTab === 'notes') await loadNotes();
            if (currentTab === 'todos') await loadTodos();
            if (currentTab === 'chat') await loadChat();
            if (currentTab === 'music') await loadMusic();
        }

        // Kiss Counter Functions
        async function loadKissCount() {
            try {
                const { data, error } = await supabase
                    .from('kiss_counter')
                    .select('count')
                    .single();

                if (data) {
                    document.getElementById('kissCount').textContent = data.count;
                }
            } catch (e) {
                console.log('Kiss counter not initialized yet');
            }
        }

        async function addKiss() {
            try {
                const { data: current } = await supabase
                    .from('kiss_counter')
                    .select('count')
                    .single();

                const newCount = (current?.count || 0) + 1;

                await supabase
                    .from('kiss_counter')
                    .upsert({ id: 1, count: newCount });

                document.getElementById('kissCount').textContent = newCount;
            } catch (e) {
                console.error('Error adding kiss:', e);
            }
        }

        async function resetKiss() {
            if (confirm('Ù…Ø·Ù…Ø¦Ù†ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø±Ùˆ Ø±ÛŒØ³Øª Ú©Ù†ÛŒØŸ')) {
                await supabase
                    .from('kiss_counter')
                    .upsert({ id: 1, count: 0 });
                document.getElementById('kissCount').textContent = '0';
            }
        }

        // Gallery Functions
        function showAddPhotoForm() {
            const form = document.getElementById('addPhotoForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        async function addPhoto() {
            const url = document.getElementById('photoUrl').value;
            const caption = document.getElementById('photoCaption').value;

            if (!url) {
                alert('Ù„Ø·ÙØ§Ù‹ Ù„ÛŒÙ†Ú© Ø¹Ú©Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†!');
                return;
            }

            try {
                await supabase
                    .from('gallery')
                    .insert([{
                        image_url: url,
                        caption: caption,
                        created_at: new Date().toISOString()
                    }]);

                document.getElementById('photoUrl').value = '';
                document.getElementById('photoCaption').value = '';
                document.getElementById('addPhotoForm').style.display = 'none';
                loadGallery();
            } catch (e) {
                console.error('Error adding photo:', e);
            }
        }

        async function loadGallery() {
            try {
                const { data, error } = await supabase
                    .from('gallery')
                    .select('*')
                    .order('created_at', { ascending: false });

                const grid = document.getElementById('galleryGrid');
                grid.innerHTML = data?.map(item => `
                    <div class="gallery-item">
                        <img src="${item.image_url}" alt="${item.caption}">
                        <div class="gallery-caption">
                            <p>${item.caption}</p>
                            <p class="gallery-date">${new Date(item.created_at).toLocaleDateString('fa-IR')}</p>
                            <button class="delete-btn" onclick="deletePhoto(${item.id})">Ø­Ø°Ù</button>
                        </div>
                    </div>
                `).join('') || '<p>Ù‡Ù†ÙˆØ² Ø¹Ú©Ø³ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡!</p>';
            } catch (e) {
                console.error('Error loading gallery:', e);
            }
        }

        async function deletePhoto(id) {
            if (confirm('Ù…Ø·Ù…Ø¦Ù†ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø§ÛŒÙ† Ø¹Ú©Ø³ Ø±Ùˆ Ø­Ø°Ù Ú©Ù†ÛŒØŸ')) {
                await supabase.from('gallery').delete().eq('id', id);
                loadGallery();
            }
        }

        // Notes Functions
        async function addNote() {
            const text = document.getElementById('noteText').value;
            if (!text) return;

            try {
                await supabase
                    .from('notes')
                    .insert([{
                        text: text,
                        created_at: new Date().toISOString()
                    }]);

                document.getElementById('noteText').value = '';
                loadNotes();
            } catch (e) {
                console.error('Error adding note:', e);
            }
        }

        async function loadNotes() {
            try {
                const { data } = await supabase
                    .from('notes')
                    .select('*')
                    .order('created_at', { ascending: false });

                const list = document.getElementById('notesList');
                list.innerHTML = data?.map(note => `
                    <div class="note-item">
                        <p>${note.text}</p>
                        <p class="note-date">${new Date(note.created_at).toLocaleDateString('fa-IR')}</p>
                        <button class="delete-btn" onclick="deleteNote(${note.id})">Ø­Ø°Ù</button>
                    </div>
                `).join('') || '<p>Ù‡Ù†ÙˆØ² ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ù†ÛŒØ³Øª!</p>';
            } catch (e) {
                console.error('Error loading notes:', e);
            }
        }

        async function deleteNote(id) {
            await supabase.from('notes').delete().eq('id', id);
            loadNotes();
        }

        // Todos Functions
        async function addTodo() {
            const text = document.getElementById('todoText').value;
            if (!text) return;

            try {
                await supabase
                    .from('todos')
                    .insert([{
                        text: text,
                        completed: false,
                        created_at: new Date().toISOString()
                    }]);

                document.getElementById('todoText').value = '';
                loadTodos();
            } catch (e) {
                console.error('Error adding todo:', e);
            }
        }

        async function loadTodos() {
            try {
                const { data } = await supabase
                    .from('todos')
                    .select('*')
                    .order('created_at', { ascending: false });

                const list = document.getElementById('todosList');
                list.innerHTML = data?.map(todo => `
                    <div class="todo-item ${todo.completed ? 'completed' : ''}">
                        <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} 
                               onchange="toggleTodo(${todo.id}, ${!todo.completed})">
                        <span style="flex: 1;">${todo.text}</span>
                        <button class="delete-btn" onclick="deleteTodo(${todo.id})">Ø­Ø°Ù</button>
                    </div>
                `).join('') || '<p>Ù‡Ù†ÙˆØ² Ú©Ø§Ø±ÛŒ Ù†ÛŒØ³Øª!</p>';
            } catch (e) {
                console.error('Error loading todos:', e);
            }
        }

        async function toggleTodo(id, completed) {
            await supabase.from('todos').update({ completed }).eq('id', id);
            loadTodos();
        }

        async function deleteTodo(id) {
            await supabase.from('todos').delete().eq('id', id);
            loadTodos();
        }

        // Chat Functions
        async function sendMessage() {
            const text = document.getElementById('chatInput').value;
            if (!text) return;

            try {
                await supabase
                    .from('chats')
                    .insert([{
                        sender: currentUser,
                        message: text,
                        created_at: new Date().toISOString()
                    }]);

                document.getElementById('chatInput').value = '';
                loadChat();
            } catch (e) {
                console.error('Error sending message:', e);
            }
        }

        async function loadChat() {
            try {
                const { data } = await supabase
                    .from('chats')
                    .select('*')
                    .order('created_at', { ascending: true });

                const container = document.getElementById('chatContainer');
                container.innerHTML = data?.map(chat => `
                    <div class="chat-message ${chat.sender}">
                        <div class="chat-bubble">
                            <p>${chat.message}</p>
                            <p class="chat-time">${new Date(chat.created_at).toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' })}</p>
                        </div>
                    </div>
                `).join('') || '<p style="text-align: center; color: #999;">Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ù…ÛŒ Ù†ÛŒØ³Øª!</p>';

                container.scrollTop = container.scrollHeight;
            } catch (e) {
                console.error('Error loading chat:', e);
            }
        }

        // Music Functions
        async function addMusic() {
            const title = document.getElementById('musicTitle').value;
            const artist = document.getElementById('musicArtist').value;
            const url = document.getElementById('musicUrl').value;

            if (!title || !url) {
                alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¢Ù‡Ù†Ú¯ Ùˆ Ù„ÛŒÙ†Ú© Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†!');
                return;
            }

            try {
                await supabase
                    .from('music')
                    .insert([{
                        title: title,
                        artist: artist || 'Ù†Ø§Ù…Ø´Ø®Øµ',
                        url: url,
                        created_at: new Date().toISOString()
                    }]);

                document.getElementById('musicTitle').value = '';
                document.getElementById('musicArtist').value = '';
                document.getElementById('musicUrl').value = '';
                loadMusic();
            } catch (e) {
                console.error('Error adding music:', e);
            }
        }

        async function loadMusic() {
            try {
                const { data } = await supabase
                    .from('music')
                    .select('*')
                    .order('created_at', { ascending: false });

                const list = document.getElementById('musicList');
                list.innerHTML = data?.map(song => `
                    <div class="music-item">
                        <div class="music-info">
                            <h3>${song.title}</h3>
                            <p class="music-artist">${song.artist}</p>
                        </div>
                        <div>
                            <button class="play-btn" onclick="window.open('${song.url}', '_blank')">â–¶ï¸ Ù¾Ø®Ø´</button>
                            <button class="delete-btn" onclick="deleteMusic(${song.id})">Ø­Ø°Ù</button>
                        </div>
                    </div>
                `).join('') || '<p>Ù‡Ù†ÙˆØ² Ø¢Ù‡Ù†Ú¯ÛŒ Ù†ÛŒØ³Øª!</p>';
            } catch (e) {
                console.error('Error loading music:', e);
            }
        }

        async function deleteMusic(id) {
            await supabase.from('music').delete().eq('id', id);
            loadMusic();
        }

        // Start the app
        init();
    </script>
</body>
</html>